<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil | ikazz - 48</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'jakarta': ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        pastel: { blue: '#EEF4FF', orange: '#FFF7ED', pink: '#FDF2F8', mint: '#ECFDF5', purple: '#F5F3FF' }
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Plus Jakarta Sans', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        .slide-up { animation: slideUp 0.4s ease-out; }
        .scale-in { animation: scaleIn 0.3s ease-out; }
        .bounce-in { animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes bounceIn { from { opacity: 0; transform: scale(0.3); } 50% { transform: scale(1.05); } to { opacity: 1; transform: scale(1); } }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1); }
        .modal-overlay { backdrop-filter: blur(12px); }
        .glass { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #ddd; border-radius: 10px; }
        .photo-upload:hover .photo-overlay { opacity: 1; }
        .photo-overlay { transition: opacity 0.3s ease; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-28">
    <!-- Header -->
    <header class="glass sticky top-0 z-40 border-b border-gray-100">
        <div class="max-w-lg mx-auto px-4 py-4 flex items-center gap-3">
            <a href="index.html" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-xl transition-colors">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </a>
            <h1 class="font-bold text-gray-800 text-lg">Profil Saya</h1>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-lg mx-auto px-4 py-6">
        <!-- Profile Card -->
        <section class="bg-white rounded-3xl p-6 border border-gray-100 shadow-sm mb-6 fade-in">
            <div class="text-center">
                <!-- Profile Photo with Upload -->
                <div class="relative inline-block mb-4">
                    <div id="profilePhotoContainer" class="photo-upload relative cursor-pointer" onclick="triggerPhotoUpload()">
                        <div id="profileAvatar" class="w-28 h-28 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center shadow-xl shadow-emerald-200/50 overflow-hidden">
                            <span id="profileInitial" class="text-white font-extrabold text-4xl">?</span>
                            <img id="profileImage" src="" alt="" class="hidden w-full h-full object-cover">
                        </div>
                        <div class="photo-overlay absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </div>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                    <div class="absolute -bottom-1 -right-1 w-9 h-9 bg-emerald-500 rounded-full flex items-center justify-center shadow-lg cursor-pointer hover:bg-emerald-600 transition-colors" onclick="triggerPhotoUpload()">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                </div>
                <h2 id="profileName" class="text-2xl font-extrabold text-gray-800 mb-1">Belum Login</h2>
                <p id="profileStatus" class="text-gray-500">Masukkan token untuk login</p>
            </div>
        </section>

        <!-- Membership Status Card -->
        <section id="membershipCard" class="hidden mb-6 slide-up">
            <div class="bg-gradient-to-br from-emerald-500 via-teal-500 to-cyan-500 rounded-2xl p-5 text-white relative overflow-hidden">
                <div class="absolute right-0 top-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
                <div class="absolute left-0 bottom-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center">
                            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <p class="text-emerald-100 text-sm font-medium">Status Membership</p>
                            <p class="font-bold text-xl" id="membershipStatusText">Aktif ‚ú®</p>
                        </div>
                    </div>
                    <div class="bg-white/20 rounded-xl p-3 mb-3">
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-emerald-100">Berlaku hingga</span>
                            <span id="membershipExpiry" class="font-bold">-</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-emerald-100">Sisa waktu</span>
                            <span id="membershipRemaining" class="font-bold">-</span>
                        </div>
                    </div>
                    <div class="w-full bg-white/30 rounded-full h-2.5 overflow-hidden">
                        <div id="membershipProgressBar" class="bg-white h-2.5 rounded-full transition-all duration-700" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Login Card (Not Logged In) -->
        <section id="loginCard" class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm mb-6 slide-up">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-emerald-100 to-teal-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                    </svg>
                </div>
                <h3 class="font-bold text-gray-800 text-xl mb-2">Login dengan Token</h3>
                <p class="text-gray-500 text-sm">Masukkan token membership untuk mengakses semua fitur</p>
            </div>

            <div class="space-y-4">
                <div>
                    <input type="text" id="loginTokenInput" placeholder="Masukkan token membership..." 
                        class="w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all text-center font-mono text-xl tracking-[0.2em] uppercase"
                        onkeypress="if(event.key==='Enter')loginWithToken()">
                    <p id="loginError" class="text-red-500 text-sm mt-2 hidden text-center"></p>
                </div>
                <button onclick="loginWithToken()" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-2xl font-bold text-lg hover:shadow-lg hover:shadow-emerald-200/50 transition-all">
                    Login
                </button>
            </div>
        </section>

        <!-- Profile Info (Logged In) -->
        <section id="profileInfo" class="hidden space-y-4 slide-up">
            <!-- Info Card -->
            <div class="bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-sm">
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                        <span class="text-lg">üë§</span>
                        Informasi Profil
                    </h3>
                </div>
                <div class="divide-y divide-gray-100">
                    <div class="p-4 flex justify-between items-center">
                        <span class="text-gray-500">Nama</span>
                        <span id="infoName" class="font-semibold text-gray-800">-</span>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <span class="text-gray-500">Jenis Kelamin</span>
                        <span id="infoGender" class="font-semibold text-gray-800">-</span>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <span class="text-gray-500">No. WhatsApp</span>
                        <span id="infoPhone" class="font-semibold text-gray-800">-</span>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <span class="text-gray-500">Token</span>
                        <span id="infoToken" class="font-mono text-sm text-emerald-600 bg-emerald-50 px-2 py-1 rounded">-</span>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <span class="text-gray-500">Device ID</span>
                        <span id="infoDevice" class="font-mono text-xs text-gray-400 truncate max-w-[140px]">-</span>
                    </div>
                </div>
            </div>

            <!-- Search Members -->
            <div class="bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-sm">
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                        <span class="text-lg">üîç</span>
                        Cari Member Lain
                    </h3>
                </div>
                <div class="p-4">
                    <div class="relative mb-4">
                        <svg class="w-5 h-5 text-gray-400 absolute left-4 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input type="text" id="searchMemberInput" placeholder="Cari nama member..." oninput="searchMembers()" 
                            class="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-sm">
                    </div>
                    <div id="memberSearchResults" class="space-y-2 max-h-64 overflow-y-auto">
                        <div class="text-center py-6 text-gray-400 text-sm">
                            <span class="text-2xl block mb-2">üë•</span>
                            Ketik nama untuk mencari member
                        </div>
                    </div>
                </div>
            </div>

            <!-- Watch History -->
            <div class="bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-sm">
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                        <span class="text-lg">üì∫</span>
                        Riwayat Menonton
                    </h3>
                </div>
                <div id="watchHistory" class="p-4">
                    <div class="text-center py-6 text-gray-400 text-sm">
                        <span class="text-2xl block mb-2">üì∫</span>
                        Belum ada riwayat menonton
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="space-y-3 pt-2">
                <button onclick="showEditProfileModal()" class="w-full py-3.5 bg-white border-2 border-gray-200 rounded-2xl font-semibold text-gray-700 hover:bg-gray-50 hover:border-gray-300 transition-all flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Edit Profil
                </button>
                <button onclick="logout()" class="w-full py-3.5 bg-red-50 border-2 border-red-100 rounded-2xl font-semibold text-red-600 hover:bg-red-100 transition-all flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                    Logout
                </button>
            </div>
        </section>

        <!-- Emergency Contact Section -->
        <section class="mt-6 slide-up" style="animation-delay: 0.2s;">
            <div class="bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-5 border border-red-100">
                <div class="flex items-start gap-4">
                    <div class="w-14 h-14 bg-red-100 rounded-xl flex items-center justify-center flex-shrink-0">
                        <svg class="w-7 h-7 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-bold text-gray-800 mb-1">üö® Darurat / Bantuan</h4>
                        <p class="text-gray-600 text-sm mb-4">Butuh bantuan segera? Hubungi admin sekarang!</p>
                        <div class="flex flex-wrap gap-2">
                            <a href="https://wa.me/6285183885551?text=Halo%20Admin,%20saya%20butuh%20bantuan%20darurat!" target="_blank" class="flex-1 min-w-[120px] px-4 py-2.5 bg-green-500 text-white rounded-xl font-semibold text-sm hover:bg-green-600 transition-colors flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                                WhatsApp
                            </a>
                            <a href="tel:+6285183885551" class="flex-1 min-w-[120px] px-4 py-2.5 bg-blue-500 text-white rounded-xl font-semibold text-sm hover:bg-blue-600 transition-colors flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                                Telepon
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Help Section -->
        <section class="mt-4 slide-up" style="animation-delay: 0.3s;">
            <div class="bg-pastel-blue rounded-2xl p-5">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800 mb-1">Butuh Bantuan?</h4>
                        <p class="text-gray-600 text-sm mb-3">Hubungi admin jika ada pertanyaan atau kendala</p>
                        <a href="mailto:admin@ikazz48.com" class="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-xl text-sm font-semibold text-blue-600 hover:bg-blue-50 transition-colors shadow-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            Kirim Email
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="fixed inset-0 bg-black/50 modal-overlay z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-md w-full p-6 scale-in max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">‚úèÔ∏è Edit Profil</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="editName" placeholder="Nama lengkap kamu" 
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Jenis Kelamin</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="flex items-center justify-center gap-2 px-4 py-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-emerald-300 transition-all has-[:checked]:border-emerald-500 has-[:checked]:bg-emerald-50">
                            <input type="radio" name="gender" value="Laki-laki" class="hidden">
                            <span class="text-lg">üë®</span>
                            <span class="font-medium">Laki-laki</span>
                        </label>
                        <label class="flex items-center justify-center gap-2 px-4 py-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-emerald-300 transition-all has-[:checked]:border-emerald-500 has-[:checked]:bg-emerald-50">
                            <input type="radio" name="gender" value="Perempuan" class="hidden">
                            <span class="text-lg">üë©</span>
                            <span class="font-medium">Perempuan</span>
                        </label>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nomor WhatsApp</label>
                    <div class="flex">
                        <span class="inline-flex items-center px-4 py-3 bg-gray-100 border-2 border-r-0 border-gray-200 rounded-l-xl text-gray-500 font-medium">+62</span>
                        <input type="tel" id="editPhone" placeholder="8123456789" 
                            class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-r-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all">
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeEditProfileModal()" class="flex-1 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50 transition-colors">Batal</button>
                <button onclick="saveProfile()" class="flex-1 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-semibold hover:shadow-lg transition-all">Simpan</button>
            </div>
        </div>
    </div>

    <!-- View Member Modal -->
    <div id="viewMemberModal" class="fixed inset-0 bg-black/50 modal-overlay z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-sm w-full overflow-hidden scale-in">
            <div class="h-24 bg-gradient-to-br from-emerald-400 to-teal-500 relative">
                <button onclick="closeViewMemberModal()" class="absolute top-3 right-3 w-8 h-8 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition-colors">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="px-6 pb-6 -mt-12">
                <div class="text-center">
                    <img id="viewMemberPhoto" src="" alt="" class="w-24 h-24 rounded-full object-cover mx-auto border-4 border-white shadow-xl mb-3">
                    <h3 id="viewMemberName" class="text-xl font-bold text-gray-800 mb-1"></h3>
                    <p id="viewMemberInfo" class="text-gray-500 text-sm mb-4"></p>
                    <div class="bg-gray-50 rounded-xl p-3 space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-500">Status</span>
                            <span id="viewMemberStatus" class="font-medium"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Member sejak</span>
                            <span id="viewMemberSince" class="font-medium text-gray-800">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-100 z-40">
        <div class="max-w-md mx-auto px-4 py-2 flex items-center justify-around">
            <a href="index.html" class="flex flex-col items-center gap-0.5 py-1.5 px-3 text-gray-400 hover:text-gray-600 transition-colors">
                <div class="w-10 h-10 hover:bg-gray-100 rounded-xl flex items-center justify-center transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                </div>
                <span class="text-xs font-medium">Home</span>
            </a>
            <a href="jadwal.html" class="flex flex-col items-center gap-0.5 py-1.5 px-3 text-gray-400 hover:text-gray-600 transition-colors">
                <div class="w-10 h-10 hover:bg-gray-100 rounded-xl flex items-center justify-center transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <span class="text-xs font-medium">Jadwal</span>
            </a>
                <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl flex items-center justify-center shadow-lg shadow-emerald-300/50 hover:shadow-xl transition-all hover:-translate-y-1">
                    <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                </div>
                <span class="text-xs font-semibold text-emerald-600 mt-1">Live</span>
            </a>
            <a href="lineup.html.html" class="flex flex-col items-center gap-0.5 py-1.5 px-3 text-gray-400 hover:text-gray-600 transition-colors">
                <div class="w-10 h-10 hover:bg-gray-100 rounded-xl flex items-center justify-center transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </div>
                <span class="text-xs font-medium">Lineup</span>
            </a>
            <a href="prof.html" class="flex flex-col items-center gap-0.5 py-1.5 px-3 text-emerald-600">
                <div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                    </svg>
                </div>
                <span class="text-xs font-semibold">Profil</span>
            </a>
        </div>
    </nav>

    <!-- Toast -->
    <div id="toast" class="fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-white rounded-2xl shadow-2xl p-4 flex items-center gap-3 z-[60] transform -translate-y-full opacity-0 transition-all duration-300 border border-gray-100">
        <div id="toastIcon" class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"></div>
        <div class="flex-1 min-w-0">
            <p id="toastTitle" class="font-bold text-gray-800"></p>
            <p id="toastMessage" class="text-sm text-gray-500"></p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

    <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDMQ961-vifb3R-Gurla3LbLM_489aHkHs-g",
            authDomain: "live2ke2.firebaseapp.com",
            projectId: "live2ke2",
            storageBucket: "live2ke2.firebasestorage.app",
            messagingSenderId: "861176752510",
            appId: "1:861176752510:web:0e1ee4e2d7f96c0b5dab2f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ==================== STATE ====================
        let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        let allMembers = [];

        // ==================== DEVICE ID ====================
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        // ==================== INITIALIZE ====================
        document.addEventListener('DOMContentLoaded', () => {
            checkUserStatus();
            loadAllMembers();
        });

        function checkUserStatus() {
            if (currentUser && currentUser.token) {
                verifyToken(currentUser.token);
            } else {
                showLoginState();
            }
        }

        async function verifyToken(token) {
            try {
                const tokenDoc = await db.collection('membershipTokens').doc(token).get();
                
                if (!tokenDoc.exists) {
                    logout();
                    return;
                }

                const tokenData = tokenDoc.data();
                const deviceId = getDeviceId();

                // Check device binding
                if (tokenData.deviceId && tokenData.deviceId !== deviceId) {
                    showToast('error', 'Error', 'Token digunakan di perangkat lain');
                    logout();
                    return;
                }

                // Check expiry
                if (tokenData.expiresAt && tokenData.expiresAt.toDate() < new Date()) {
                    showToast('error', 'Kadaluarsa', 'Membership sudah berakhir');
                    logout();
                    return;
                }

                // Update current user
                currentUser = {
                    ...currentUser,
                    ...tokenData,
                    token: token,
                    membershipExpiry: tokenData.expiresAt
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                showLoggedInState();
            } catch (error) {
                console.error('Verify token error:', error);
                showLoginState();
            }
        }

        // ==================== LOGIN ====================
        async function loginWithToken() {
            const token = document.getElementById('loginTokenInput').value.trim().toUpperCase();
            const errorEl = document.getElementById('loginError');

            if (!token) {
                errorEl.textContent = 'Masukkan token membership';
                errorEl.classList.remove('hidden');
                return;
            }

            try {
                const tokenDoc = await db.collection('membershipTokens').doc(token).get();

                if (!tokenDoc.exists) {
                    errorEl.textContent = 'Token tidak ditemukan';
                    errorEl.classList.remove('hidden');
                    return;
                }

                const tokenData = tokenDoc.data();
                const deviceId = getDeviceId();

                // Check if bound to another device
                if (tokenData.deviceId && tokenData.deviceId !== deviceId) {
                    errorEl.textContent = 'Token sudah digunakan di perangkat lain';
                    errorEl.classList.remove('hidden');
                    return;
                }

                // Check expiry
                if (tokenData.expiresAt && tokenData.expiresAt.toDate() < new Date()) {
                    errorEl.textContent = 'Token sudah kadaluarsa';
                    errorEl.classList.remove('hidden');
                    return;
                }

                // Bind to device
                await db.collection('membershipTokens').doc(token).update({
                    deviceId: deviceId,
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Save user
                currentUser = {
                    token: token,
                    ...tokenData,
                    deviceId: deviceId,
                    membershipExpiry: tokenData.expiresAt
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                errorEl.classList.add('hidden');
                showLoggedInState();
                showToast('success', 'Login Berhasil', 'Selamat datang!');

            } catch (error) {
                console.error('Login error:', error);
                errorEl.textContent = 'Terjadi kesalahan';
                errorEl.classList.remove('hidden');
            }
        }

        // ==================== UI STATES ====================
        function showLoginState() {
            document.getElementById('loginCard').classList.remove('hidden');
            document.getElementById('membershipCard').classList.add('hidden');
            document.getElementById('profileInfo').classList.add('hidden');

            document.getElementById('profileName').textContent = 'Belum Login';
            document.getElementById('profileStatus').textContent = 'Masukkan token untuk login';
            document.getElementById('profileInitial').textContent = '?';
            document.getElementById('profileInitial').classList.remove('hidden');
            document.getElementById('profileImage').classList.add('hidden');
        }

        function showLoggedInState() {
            document.getElementById('loginCard').classList.add('hidden');
            document.getElementById('membershipCard').classList.remove('hidden');
            document.getElementById('profileInfo').classList.remove('hidden');

            // Update profile header
            const name = currentUser.name || 'Member';
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileStatus').textContent = '‚ú® Member Aktif';

            // Update photo
            if (currentUser.photo) {
                document.getElementById('profileInitial').classList.add('hidden');
                document.getElementById('profileImage').classList.remove('hidden');
                document.getElementById('profileImage').src = currentUser.photo;
            } else {
                document.getElementById('profileInitial').classList.remove('hidden');
                document.getElementById('profileImage').classList.add('hidden');
                document.getElementById('profileInitial').textContent = name.charAt(0).toUpperCase();
            }

            // Update info
            document.getElementById('infoName').textContent = currentUser.name || '-';
            document.getElementById('infoGender').textContent = currentUser.gender || '-';
            document.getElementById('infoPhone').textContent = currentUser.phone || '-';
            document.getElementById('infoToken').textContent = currentUser.token || '-';
            document.getElementById('infoDevice').textContent = getDeviceId();

            // Update membership card
            updateMembershipDisplay();
        }

        function updateMembershipDisplay() {
            const expiry = currentUser.membershipExpiry?.toDate ? currentUser.membershipExpiry.toDate() : new Date(currentUser.membershipExpiry);
            const now = new Date();

            if (expiry < now) {
                document.getElementById('membershipStatusText').textContent = 'Kadaluarsa ‚ùå';
                document.getElementById('membershipCard').classList.remove('from-emerald-500', 'via-teal-500', 'to-cyan-500');
                document.getElementById('membershipCard').querySelector('div').classList.add('from-gray-500', 'to-gray-600');
            } else {
                document.getElementById('membershipStatusText').textContent = 'Aktif ‚ú®';
            }

            document.getElementById('membershipExpiry').textContent = expiry.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            // Calculate remaining
            const diffTime = expiry - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays > 0) {
                document.getElementById('membershipRemaining').textContent = diffDays + ' hari';
            } else {
                document.getElementById('membershipRemaining').textContent = 'Sudah berakhir';
            }

            // Progress bar
            const createdAt = currentUser.createdAt?.toDate ? currentUser.createdAt.toDate() : new Date(currentUser.createdAt || now);
            const totalDays = (expiry - createdAt) / (1000 * 60 * 60 * 24);
            const remainingDays = Math.max(0, (expiry - now) / (1000 * 60 * 60 * 24));
            const progress = Math.max(0, Math.min(100, (remainingDays / totalDays) * 100));

            document.getElementById('membershipProgressBar').style.width = progress + '%';
        }

        // ==================== PHOTO UPLOAD ====================
        function triggerPhotoUpload() {
            if (!currentUser || !currentUser.token) {
                showToast('error', 'Error', 'Login terlebih dahulu');
                return;
            }
            document.getElementById('photoInput').click();
        }

        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                showToast('error', 'Error', 'Ukuran file maksimal 2MB');
                return;
            }

            // Convert to base64
            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64 = e.target.result;
                
                try {
                    // Save to Firestore
                    await db.collection('membershipTokens').doc(currentUser.token).update({
                        photo: base64,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Update local state
                    currentUser.photo = base64;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));

                    // Update UI
                    document.getElementById('profileInitial').classList.add('hidden');
                    document.getElementById('profileImage').classList.remove('hidden');
                    document.getElementById('profileImage').src = base64;

                    showToast('success', 'Berhasil', 'Foto profil diperbarui');
                } catch (error) {
                    console.error('Upload error:', error);
                    showToast('error', 'Error', 'Gagal mengupload foto');
                }
            };
            reader.readAsDataURL(file);
        }

        // ==================== EDIT PROFILE ====================
        function showEditProfileModal() {
            if (!currentUser || !currentUser.token) {
                showToast('error', 'Error', 'Login terlebih dahulu');
                return;
            }

            document.getElementById('editName').value = currentUser.name || '';
            document.getElementById('editPhone').value = (currentUser.phone || '').replace('+62', '').replace(/^0/, '');

            // Set gender radio
            const genderRadios = document.querySelectorAll('input[name="gender"]');
            genderRadios.forEach(radio => {
                radio.checked = radio.value === currentUser.gender;
                if (radio.checked) {
                    radio.closest('label').classList.add('border-emerald-500', 'bg-emerald-50');
                } else {
                    radio.closest('label').classList.remove('border-emerald-500', 'bg-emerald-50');
                }
            });

            // Add event listeners for radio buttons
            genderRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    genderRadios.forEach(r => {
                        if (r.checked) {
                            r.closest('label').classList.add('border-emerald-500', 'bg-emerald-50');
                        } else {
                            r.closest('label').classList.remove('border-emerald-500', 'bg-emerald-50');
                        }
                    });
                });
            });

            document.getElementById('editProfileModal').classList.remove('hidden');
            document.getElementById('editProfileModal').classList.add('flex');
        }

        function closeEditProfileModal() {
            document.getElementById('editProfileModal').classList.add('hidden');
            document.getElementById('editProfileModal').classList.remove('flex');
        }

        async function saveProfile() {
            const name = document.getElementById('editName').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const genderRadio = document.querySelector('input[name="gender"]:checked');
            const gender = genderRadio ? genderRadio.value : '';

            if (!name) {
                showToast('error', 'Error', 'Nama tidak boleh kosong');
                return;
            }

            try {
                await db.collection('membershipTokens').doc(currentUser.token).update({
                    name,
                    gender,
                    phone: phone ? '+62' + phone.replace(/^0/, '') : '',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                currentUser.name = name;
                currentUser.gender = gender;
                currentUser.phone = phone ? '+62' + phone.replace(/^0/, '') : '';
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                closeEditProfileModal();
                showLoggedInState();
                showToast('success', 'Berhasil', 'Profil berhasil disimpan');

            } catch (error) {
                console.error('Save profile error:', error);
                showToast('error', 'Error', 'Gagal menyimpan profil');
            }
        }

        // ==================== SEARCH MEMBERS ====================
        function loadAllMembers() {
            db.collection('membershipTokens').onSnapshot(snapshot => {
                allMembers = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.name) {
                        allMembers.push({ token: doc.id, ...data });
                    }
                });
            });
        }

        function searchMembers() {
            const query = document.getElementById('searchMemberInput').value.toLowerCase().trim();
            const container = document.getElementById('memberSearchResults');

            if (!query) {
                container.innerHTML = `
                    <div class="text-center py-6 text-gray-400 text-sm">
                        <span class="text-2xl block mb-2">üë•</span>
                        Ketik nama untuk mencari member
                    </div>
                `;
                return;
            }

            // Filter out current user
            const filtered = allMembers.filter(m => 
                m.name && 
                m.name.toLowerCase().includes(query) && 
                m.token !== currentUser?.token
            );

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-6 text-gray-400 text-sm">
                        <span class="text-2xl block mb-2">üòï</span>
                        Tidak ditemukan member dengan nama "${query}"
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            filtered.slice(0, 10).forEach(member => {
                const card = document.createElement('div');
                card.className = 'flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-all';
                card.onclick = () => viewMember(member);

                const exp = member.expiresAt?.toDate();
                const isActive = exp && exp > new Date();

                card.innerHTML = `
                    <img src="${member.photo || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(member.name) + '&background=10b981&color=fff'}" 
                        class="w-12 h-12 rounded-full object-cover border-2 border-white shadow" 
                        onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(member.name)}&background=10b981&color=fff'">
                    <div class="flex-1 min-w-0">
                        <p class="font-semibold text-gray-800 truncate">${member.name}</p>
                        <p class="text-xs ${isActive ? 'text-emerald-600' : 'text-gray-400'}">${isActive ? '‚úÖ Member Aktif' : '‚ùå Tidak Aktif'}</p>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                `;
                container.appendChild(card);
            });
        }

        function viewMember(member) {
            document.getElementById('viewMemberPhoto').src = member.photo || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(member.name) + '&background=10b981&color=fff&size=200';
            document.getElementById('viewMemberName').textContent = member.name || '-';
            
            const exp = member.expiresAt?.toDate();
            const isActive = exp && exp > new Date();
            
            document.getElementById('viewMemberInfo').textContent = member.gender || 'Member';
            document.getElementById('viewMemberStatus').textContent = isActive ? '‚úÖ Aktif' : '‚ùå Tidak Aktif';
            document.getElementById('viewMemberStatus').className = `font-medium ${isActive ? 'text-emerald-600' : 'text-red-500'}`;
            
            const createdAt = member.createdAt?.toDate ? member.createdAt.toDate() : null;
            document.getElementById('viewMemberSince').textContent = createdAt ? createdAt.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' }) : '-';

            document.getElementById('viewMemberModal').classList.remove('hidden');
            document.getElementById('viewMemberModal').classList.add('flex');
        }

        function closeViewMemberModal() {
            document.getElementById('viewMemberModal').classList.add('hidden');
            document.getElementById('viewMemberModal').classList.remove('flex');
        }

        // ==================== LOGOUT ====================
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLoginState();
            showToast('info', 'Logout', 'Anda telah keluar');
        }

        // ==================== TOAST ====================
        function showToast(type, title, message) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');

            const icons = {
                success: { bg: 'bg-emerald-100', emoji: '‚úÖ' },
                error: { bg: 'bg-red-100', emoji: '‚ùå' },
                info: { bg: 'bg-blue-100', emoji: '‚ÑπÔ∏è' }
            };

            const icon = icons[type] || icons.info;
            toastIcon.className = `w-12 h-12 rounded-xl flex items-center justify-center ${icon.bg}`;
            toastIcon.innerHTML = `<span class="text-2xl">${icon.emoji}</span>`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toast.classList.remove('-translate-y-full', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');

            setTimeout(() => {
                toast.classList.add('-translate-y-full', 'opacity-0');
                toast.classList.remove('translate-y-0', 'opacity-100');
            }, 4000);
        }

        // Close modals when clicking overlay
        document.getElementById('editProfileModal').addEventListener('click', function(e) {
            if (e.target === this) closeEditProfileModal();
        });
        document.getElementById('viewMemberModal').addEventListener('click', function(e) {
            if (e.target === this) closeViewMemberModal();
        });
    </script>
</body>
</html>