<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Show | Ikazz - 48</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sage: '#E3F0E9',
                        blush: '#FFE5E5',
                        peach: '#FFE8D9',
                        dark: '#1C1C1E',
                        secondary: '#8E8E93',
                        divider: '#E5E5E7'
                    },
                    fontFamily: {
                        sans: ['Outfit', 'Inter', 'sans-serif']
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'gradient': 'gradient 3s ease infinite',
                    },
                    keyframes: {
                        gradient: {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Outfit', 'Inter', sans-serif; }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        
        .animate-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .animate-slideIn {
            animation: slideIn 0.3s ease-out forwards;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(229, 229, 231, 0.3);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(229, 229, 231, 0.5);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 30px -10px rgba(0,0,0,0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(-45deg, #E3F0E9, #FFE5E5, #FFE8D9, #E3F0E9);
            background-size: 400% 400%;
            animation: gradient 10s ease infinite;
        }
        
        .today-badge {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
        }
        
        .tab-active {
            border-bottom: 3px solid #10b981;
            color: #10b981;
            font-weight: 600;
        }
        
        .filter-btn {
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
    </style>
</head>
<body class="bg-[#F8FAFC] min-h-screen pb-24">
    <!-- Header -->
    <header class="sticky top-0 z-40 glass border-b border-divider/30">
        <div class="max-w-lg mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-dark">Jadwal Show</h1>
                    <p class="text-secondary text-sm mt-0.5">Upcoming live streaming JKT48</p>
                </div>
                <button onclick="location.href='prof.html'" class="w-10 h-10 bg-sage/50 rounded-2xl flex items-center justify-center hover:bg-sage/70 transition-colors">
                    <svg class="w-5 h-5 text-emerald-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-lg mx-auto px-6 py-6">
        <!-- Stats Cards -->
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-divider/20 animate-fadeInUp" style="animation-delay: 0.1s">
                <p class="text-secondary text-sm mb-1">Total Show</p>
                <p class="text-2xl font-bold text-dark" id="totalShows">0</p>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-divider/20 animate-fadeInUp" style="animation-delay: 0.15s">
                <p class="text-secondary text-sm mb-1">Bulan Ini</p>
                <p class="text-2xl font-bold text-emerald-600" id="monthShows">0</p>
            </div>
        </div>

        <!-- Filter & Search Section -->
        <div class="bg-white rounded-2xl p-4 shadow-sm border border-divider/20 mb-6 animate-fadeInUp" style="animation-delay: 0.2s">
            <div class="flex items-center justify-between mb-3">
                <h3 class="font-medium text-dark">Filter</h3>
                <button onclick="resetFilter()" class="text-xs text-emerald-600 font-medium hover:text-emerald-700 transition-colors">
                    Reset
                </button>
            </div>
            
            <!-- Search Bar -->
            <div class="relative mb-4">
                <svg class="w-5 h-5 text-secondary absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" id="searchInput" placeholder="Cari judul show..." 
                    class="w-full pl-10 pr-4 py-2.5 bg-gray-50 rounded-xl text-dark placeholder:text-secondary/60 focus:outline-none focus:ring-2 focus:ring-emerald-500/30 border border-divider/30"
                    onkeyup="filterJadwal()">
            </div>
            
            <!-- Filter Tabs -->
            <div class="flex gap-2 overflow-x-auto scrollbar-hide pb-1">
                <button onclick="filterBy('all')" id="filter-all" class="filter-btn active px-4 py-2 bg-emerald-500 text-white rounded-xl text-sm font-medium whitespace-nowrap">Semua</button>
                <button onclick="filterBy('today')" id="filter-today" class="filter-btn px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-medium whitespace-nowrap hover:bg-gray-200">Hari Ini</button>
                <button onclick="filterBy('tomorrow')" id="filter-tomorrow" class="filter-btn px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-medium whitespace-nowrap hover:bg-gray-200">Besok</button>
                <button onclick="filterBy('week')" id="filter-week" class="filter-btn px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-medium whitespace-nowrap hover:bg-gray-200">Minggu Ini</button>
                <button onclick="filterBy('month')" id="filter-month" class="filter-btn px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-medium whitespace-nowrap hover:bg-gray-200">Bulan Ini</button>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-3 gap-3 mb-6 animate-fadeInUp" style="animation-delay: 0.25s">
            <button onclick="showCalendar()" class="bg-sage/30 rounded-xl p-3 text-center card-hover">
                <div class="w-8 h-8 bg-white rounded-xl flex items-center justify-center mx-auto mb-1">
                    <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <span class="text-xs font-medium text-dark">Kalender</span>
            </button>
            <button onclick="sortBy('nearest')" class="bg-blush/30 rounded-xl p-3 text-center card-hover">
                <div class="w-8 h-8 bg-white rounded-xl flex items-center justify-center mx-auto mb-1">
                    <svg class="w-4 h-4 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                    </svg>
                </div>
                <span class="text-xs font-medium text-dark">Terdekat</span>
            </button>
            <button onclick="toggleReminder()" class="bg-peach/30 rounded-xl p-3 text-center card-hover">
                <div class="w-8 h-8 bg-white rounded-xl flex items-center justify-center mx-auto mb-1">
                    <svg class="w-4 h-4 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                </div>
                <span class="text-xs font-medium text-dark">Notifikasi</span>
            </button>
        </div>

        <!-- Jadwal List -->
        <div id="jadwalList" class="space-y-4">
            <!-- Loading State -->
            <div class="text-center py-16">
                <div class="w-16 h-16 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin mx-auto"></div>
                <p class="text-secondary mt-4">Memuat jadwal...</p>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-16 animate-fadeInUp">
            <div class="w-24 h-24 bg-gradient-to-br from-sage/30 to-peach/30 rounded-full flex items-center justify-center mx-auto mb-4 animate-float">
                <svg class="w-12 h-12 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
            <h3 class="text-lg font-semibold text-dark mb-2">Tidak Ada Jadwal</h3>
            <p class="text-secondary text-sm mb-6">Belum ada jadwal show untuk periode ini</p>
            <button onclick="resetFilter()" class="px-6 py-2.5 bg-emerald-500 text-white font-medium rounded-xl hover:bg-emerald-600 transition-colors">
                Lihat Semua
            </button>
        </div>
    </main>

    <!-- Calendar Modal -->
    <div id="calendarModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" onclick="hideCalendar()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 max-h-[80vh] overflow-y-auto transform transition-transform duration-300 translate-y-full" id="calendarContent">
            <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <h3 class="text-xl font-semibold text-dark mb-4">Kalender Show</h3>
            
            <!-- Month Selector -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="changeMonth(-1)" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <span class="font-semibold text-dark" id="currentMonth">Februari 2026</span>
                <button onclick="changeMonth(1)" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
            
            <!-- Calendar Grid -->
            <div class="grid grid-cols-7 gap-1 mb-4">
                <div class="text-center text-xs text-secondary py-2">Min</div>
                <div class="text-center text-xs text-secondary py-2">Sen</div>
                <div class="text-center text-xs text-secondary py-2">Sel</div>
                <div class="text-center text-xs text-secondary py-2">Rab</div>
                <div class="text-center text-xs text-secondary py-2">Kam</div>
                <div class="text-center text-xs text-secondary py-2">Jum</div>
                <div class="text-center text-xs text-secondary py-2">Sab</div>
            </div>
            <div id="calendarDays" class="grid grid-cols-7 gap-1">
                <!-- Filled by JS -->
            </div>
            
            <!-- Legend -->
            <div class="flex items-center gap-4 mt-6 pt-4 border-t border-divider/30">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-emerald-500 rounded-full"></div>
                    <span class="text-xs text-secondary">Ada Show</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-gray-200 rounded-full"></div>
                    <span class="text-xs text-secondary">Tidak Ada</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Reminder Modal -->
    <div id="reminderModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" onclick="hideReminder()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 transform transition-transform duration-300 translate-y-full" id="reminderContent">
            <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <h3 class="text-xl font-semibold text-dark mb-4">Setel Pengingat</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-dark mb-2">Pilih Jadwal</label>
                    <select id="reminderJadwal" class="w-full px-4 py-3 bg-gray-50 rounded-xl border border-divider focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="">Pilih show...</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-dark mb-2">Pengingat</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer">
                            <input type="radio" name="reminderTime" value="15" class="text-emerald-500">
                            <span class="text-dark text-sm">15 menit sebelumnya</span>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer">
                            <input type="radio" name="reminderTime" value="30" class="text-emerald-500">
                            <span class="text-dark text-sm">30 menit sebelumnya</span>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer">
                            <input type="radio" name="reminderTime" value="60" class="text-emerald-500">
                            <span class="text-dark text-sm">1 jam sebelumnya</span>
                        </label>
                    </div>
                </div>
                
                <button onclick="setReminder()" class="w-full py-3 bg-emerald-500 text-white font-medium rounded-xl hover:bg-emerald-600 transition-colors mt-4">
                    Aktifkan Pengingat
                </button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 glass border-t border-divider/30 z-40">
        <div class="max-w-lg mx-auto px-4 py-2">
            <div class="flex items-center justify-around">
                <a href="index.html" class="bottom-nav-item active flex flex-col items-center py-1 px-3">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium">Home</span>
                </a>
                <a href="jadwal.html" class="bottom-nav-item flex flex-col items-center py-1 px-3 text-secondary">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium">Jadwal</span>
                </a>
                <a href="shop.html" class="bottom-nav-item flex flex-col items-center py-1 px-3 text-secondary">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium">Shop</span>
                </a>
                <a href="about.html" class="bottom-nav-item flex flex-col items-center py-1 px-3 text-secondary">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1z" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium">about</span>
                </a>
                <a href="prof.html" class="bottom-nav-item flex flex-col items-center py-1 px-3 text-secondary">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <span class="text-xs font-medium">Profil</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyA9auv4Fb4qZgQmVt501XvgEL_hgHmFsjg",
            authDomain: "liveee-c493c.firebaseapp.com",
            projectId: "liveee-c493c",
            storageBucket: "liveee-c493c.firebasestorage.app",
            messagingSenderId: "359936219000",
            appId: "1:359936219000:web:ccd25480e9e7336b535a8d"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // State
        let allJadwal = [];
        let filteredJadwal = [];
        let currentFilter = 'all';
        let searchTerm = '';
        let sortOrder = 'asc';
        let currentMonth = new Date();

        // Initialize
        document.addEventListener('DOMContentLoaded', loadJadwal);

        // Load Jadwal from Firebase
        async function loadJadwal() {
            const container = document.getElementById('jadwalList');
            const emptyState = document.getElementById('emptyState');
            
            try {
                const snapshot = await db.collection('jadwal')
                    .orderBy('datetime', 'asc')
                    .get();
                
                allJadwal = [];
                snapshot.forEach(doc => {
                    allJadwal.push({ id: doc.id, ...doc.data() });
                });

                if (allJadwal.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    updateStats();
                    return;
                }

                emptyState.classList.add('hidden');
                updateStats();
                applyFilter();
                
            } catch (e) {
                console.error('Error loading jadwal:', e);
                container.innerHTML = '<p class="text-center text-red-500 py-8">Gagal memuat jadwal</p>';
            }
        }

        // Update Statistics
        function updateStats() {
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            
            document.getElementById('totalShows').textContent = allJadwal.length;
            
            const monthShows = allJadwal.filter(j => {
                const date = j.datetime?.toDate ? j.datetime.toDate() : new Date(j.datetime);
                return date >= monthStart;
            }).length;
            
            document.getElementById('monthShows').textContent = monthShows;
        }

        // Filter Functions
        function filterBy(filter) {
            currentFilter = filter;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-emerald-500', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-600');
            });
            
            const activeBtn = document.getElementById(`filter-${filter}`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-100', 'text-gray-600');
                activeBtn.classList.add('active', 'bg-emerald-500', 'text-white');
            }
            
            applyFilter();
        }

        function filterJadwal() {
            searchTerm = document.getElementById('searchInput').value.toLowerCase();
            applyFilter();
        }

        function resetFilter() {
            document.getElementById('searchInput').value = '';
            searchTerm = '';
            currentFilter = 'all';
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-emerald-500', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-600');
            });
            
            const allBtn = document.getElementById('filter-all');
            allBtn.classList.remove('bg-gray-100', 'text-gray-600');
            allBtn.classList.add('active', 'bg-emerald-500', 'text-white');
            
            applyFilter();
        }

        function applyFilter() {
            const now = new Date();
            const tomorrow = new Date(now.getTime() + 86400000);
            const weekEnd = new Date(now.getTime() + 7 * 86400000);
            const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            
            // Apply filter
            filteredJadwal = allJadwal.filter(j => {
                const date = j.datetime?.toDate ? j.datetime.toDate() : new Date(j.datetime);
                
                // Date filter
                if (currentFilter === 'today') {
                    if (date.toDateString() !== now.toDateString()) return false;
                } else if (currentFilter === 'tomorrow') {
                    if (date.toDateString() !== tomorrow.toDateString()) return false;
                } else if (currentFilter === 'week') {
                    if (date < now || date > weekEnd) return false;
                } else if (currentFilter === 'month') {
                    if (date < now || date > monthEnd) return false;
                }
                
                // Search filter
                if (searchTerm && !j.title.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                return true;
            });
            
            // Sort
            filteredJadwal.sort((a, b) => {
                const dateA = a.datetime?.toDate ? a.datetime.toDate() : new Date(a.datetime);
                const dateB = b.datetime?.toDate ? b.datetime.toDate() : new Date(b.datetime);
                return sortOrder === 'asc' ? dateA - dateB : dateB - dateA;
            });
            
            renderJadwal();
        }

        function sortBy(order) {
            sortOrder = order === 'nearest' ? 'asc' : 'desc';
            applyFilter();
        }

        // Render Jadwal
        function renderJadwal() {
            const container = document.getElementById('jadwalList');
            const emptyState = document.getElementById('emptyState');
            const now = new Date();
            
            if (filteredJadwal.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            container.innerHTML = '';
            
            filteredJadwal.forEach((jadwal, index) => {
                const date = jadwal.datetime?.toDate ? jadwal.datetime.toDate() : new Date(jadwal.datetime);
                const isToday = date.toDateString() === now.toDateString();
                const isTomorrow = date.toDateString() === new Date(now.getTime() + 86400000).toDateString();
                const isPast = date < now;
                const timeDiff = date - now;
                const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                
                let dayLabel = date.toLocaleDateString('id-ID', { 
                    weekday: 'long', 
                    day: 'numeric', 
                    month: 'long' 
                });
                
                if (isToday) dayLabel = 'Hari Ini';
                else if (isTomorrow) dayLabel = 'Besok';
                
                const timeLeft = isPast ? 'Sudah lewat' : 
                    daysDiff === 0 ? 'Hari ini' :
                    daysDiff === 1 ? 'Besok' :
                    `${daysDiff} hari lagi`;

                container.innerHTML += `
                    <div class="card-hover bg-white rounded-2xl p-5 border border-divider/20 animate-fadeInUp" 
                         style="animation-delay:${index * 0.1}s"
                         onclick="showJadwalDetail('${jadwal.id}')">
                        <div class="flex items-start gap-4">
                            <!-- Date Badge -->
                            <div class="relative">
                                <div class="w-16 h-16 ${isToday ? 'today-badge' : 'bg-sage/50'} rounded-2xl flex flex-col items-center justify-center flex-shrink-0">
                                    <span class="text-xs ${isToday ? 'text-white/90' : 'text-emerald-600'} font-medium">
                                        ${date.toLocaleDateString('id-ID', { weekday: 'short' })}
                                    </span>
                                    <span class="text-xl font-bold ${isToday ? 'text-white' : 'text-emerald-700'}">
                                        ${date.getDate()}
                                    </span>
                                </div>
                                ${isToday ? `
                                    <span class="absolute -top-1 -right-1 w-3 h-3">
                                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                        <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                                    </span>
                                ` : ''}
                            </div>
                            
                            <!-- Content -->
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-xs font-medium ${isToday ? 'bg-emerald-100 text-emerald-700' : 'bg-gray-100 text-gray-600'} px-2 py-0.5 rounded-full">
                                        ${dayLabel}
                                    </span>
                                    <span class="text-xs text-secondary">${timeLeft}</span>
                                </div>
                                
                                <h3 class="font-semibold text-dark text-lg mb-1">${jadwal.title}</h3>
                                
                                <div class="flex items-center gap-3 text-sm text-secondary mb-2">
                                    <span class="flex items-center gap-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        ${date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })} WIB
                                    </span>
                                </div>
                                
                                ${jadwal.lineup ? `
                                    <div class="flex items-center gap-2 mt-2">
                                        <div class="flex -space-x-2">
                                            ${jadwal.lineup.split(',').slice(0, 3).map(name => `
                                                <div class="w-6 h-6 rounded-full bg-gradient-to-br from-sage to-peach border-2 border-white flex items-center justify-center text-[10px] font-medium text-emerald-700">
                                                    ${name.trim()[0]}
                                                </div>
                                            `).join('')}
                                        </div>
                                        <span class="text-xs text-emerald-600">+${jadwal.lineup.split(',').length} member</span>
                                    </div>
                                ` : ''}
                                
                                <!-- Action Buttons -->
                                <div class="flex items-center gap-2 mt-3">
                                    <button onclick="event.stopPropagation(); setReminderForJadwal('${jadwal.id}', '${jadwal.title}')" 
                                            class="px-3 py-1.5 bg-sage/50 rounded-xl text-xs font-medium text-emerald-700 hover:bg-sage/70 transition-colors">
                                        ðŸ”” Ingatkan
                                    </button>
                                    <button onclick="event.stopPropagation(); shareJadwal('${jadwal.title}', '${date.toISOString()}')" 
                                            class="px-3 py-1.5 bg-gray-100 rounded-xl text-xs font-medium text-gray-600 hover:bg-gray-200 transition-colors">
                                        ðŸ“¤ Bagikan
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Modal Functions
        function showCalendar() {
            document.getElementById('calendarModal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('calendarContent').classList.remove('translate-y-full');
            }, 10);
            renderCalendar();
        }

        function hideCalendar() {
            document.getElementById('calendarContent').classList.add('translate-y-full');
            setTimeout(() => {
                document.getElementById('calendarModal').classList.add('hidden');
            }, 300);
        }

        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay(); // 0 = Minggu
            
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Get show dates
            const showDates = new Set();
            allJadwal.forEach(j => {
                const date = j.datetime?.toDate ? j.datetime.toDate() : new Date(j.datetime);
                if (date.getMonth() === month && date.getFullYear() === year) {
                    showDates.add(date.getDate());
                }
            });
            
            let calendarHtml = '';
            // Empty cells for days before first day
            for (let i = 0; i < startDay; i++) {
                calendarHtml += '<div class="aspect-square"></div>';
            }
            
            // Days of the month
            for (let d = 1; d <= lastDay.getDate(); d++) {
                const hasShow = showDates.has(d);
                const isToday = d === new Date().getDate() && 
                               month === new Date().getMonth() && 
                               year === new Date().getFullYear();
                
                calendarHtml += `
                    <div class="aspect-square flex items-center justify-center">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center
                                  ${hasShow ? 'bg-emerald-100 text-emerald-700 font-semibold cursor-pointer hover:bg-emerald-200' : 'text-gray-600'}
                                  ${isToday ? 'ring-2 ring-emerald-500' : ''}
                                  ${hasShow ? 'show-day' : ''}"
                             data-day="${d}"
                             onclick="${hasShow ? `showShowsOnDay(${d})` : ''}">
                            ${d}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('calendarDays').innerHTML = calendarHtml;
        }

        function changeMonth(delta) {
            currentMonth = new Date(currentMonth.setMonth(currentMonth.getMonth() + delta));
            renderCalendar();
        }

        function showShowsOnDay(day) {
            const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
            const showsOnDay = allJadwal.filter(j => {
                const jDate = j.datetime?.toDate ? j.datetime.toDate() : new Date(j.datetime);
                return jDate.toDateString() === date.toDateString();
            });
            
            if (showsOnDay.length > 0) {
                alert(`Ada ${showsOnDay.length} show pada tanggal ${date.toLocaleDateString('id-ID')}`);
                // Bisa ditambahkan modal detail
            }
        }

        // Reminder Functions
        function toggleReminder() {
            showReminderModal();
        }

        function showReminderModal() {
            const select = document.getElementById('reminderJadwal');
            select.innerHTML = '<option value="">Pilih show...</option>';
            
            allJadwal.forEach(j => {
                const date = j.datetime?.toDate ? j.datetime.toDate() : new Date(j.datetime);
                if (date > new Date()) {
                    select.innerHTML += `<option value="${j.id}">${j.title} - ${date.toLocaleDateString('id-ID')}</option>`;
                }
            });
            
            document.getElementById('reminderModal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('reminderContent').classList.remove('translate-y-full');
            }, 10);
        }

        function hideReminder() {
            document.getElementById('reminderContent').classList.add('translate-y-full');
            setTimeout(() => {
                document.getElementById('reminderModal').classList.add('hidden');
            }, 300);
        }

        function setReminderForJadwal(id, title) {
            document.getElementById('reminderJadwal').value = id;
            showReminderModal();
        }

        function setReminder() {
            const jadwalId = document.getElementById('reminderJadwal').value;
            const reminderTime = document.querySelector('input[name="reminderTime"]:checked')?.value;
            
            if (!jadwalId || !reminderTime) {
                alert('Pilih jadwal dan waktu pengingat!');
                return;
            }
            
            // Simpan ke localStorage
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            reminders.push({
                jadwalId,
                time: parseInt(reminderTime),
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('reminders', JSON.stringify(reminders));
            
            alert('Pengingat berhasil disetel!');
            hideReminder();
            
            // Cek izin notifikasi
            if (Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
        }

        // Share Function
        function shareJadwal(title, dateStr) {
            const date = new Date(dateStr);
            const formattedDate = date.toLocaleDateString('id-ID', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const text = `ðŸŽ¥ Jangan lewatkan! ${title}\nðŸ“… ${formattedDate} WIB\n\n#JKT48 #Ikazz48`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Jadwal Show JKT48',
                    text: text,
                }).catch(() => {
                    copyToClipboard(text);
                });
            } else {
                copyToClipboard(text);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Jadwal disalin!');
            }).catch(() => {
                prompt('Copy manual:', text);
            });
        }

        // Detail Function
        function showJadwalDetail(id) {
            const jadwal = allJadwal.find(j => j.id === id);
            if (!jadwal) return;
            
            const date = jadwal.datetime?.toDate ? jadwal.datetime.toDate() : new Date(jadwal.datetime);
            
            alert(`
                ðŸ“… ${jadwal.title}
                ðŸ“† ${date.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}
                ðŸ• ${date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })} WIB
                ðŸ‘¥ Lineup: ${jadwal.lineup || 'TBA'}
            `);
        }

        // Check reminders (jalankan setiap menit)
        setInterval(() => {
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            const now = new Date();
            
            reminders.forEach((reminder, index) => {
                const jadwal = allJadwal.find(j => j.id === reminder.jadwalId);
                if (!jadwal) return;
                
                const showTime = jadwal.datetime?.toDate ? jadwal.datetime.toDate() : new Date(jadwal.datetime);
                const reminderTime = new Date(showTime.getTime() - reminder.time * 60000);
                
                if (reminderTime <= now && now < showTime) {
                    // Tampilkan notifikasi
                    if (Notification.permission === 'granted') {
                        new Notification('ðŸ”” Pengingat Show JKT48', {
                            body: `${jadwal.title} akan dimulai dalam ${reminder.time} menit!`,
                            icon: 'https://via.placeholder.com/100'
                        });
                    } else {
                        alert(`ðŸ”” ${jadwal.title} akan dimulai dalam ${reminder.time} menit!`);
                    }
                    
                    // Hapus reminder
                    reminders.splice(index, 1);
                    localStorage.setItem('reminders', JSON.stringify(reminders));
                }
            });
        }, 60000); // Cek setiap menit

        // Minta izin notifikasi
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
    </script>
</body>
</html>