<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ikazz - 48 | Live Streaming</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'jakarta': ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        primary: { 50: '#f0fdf4', 100: '#dcfce7', 500: '#22c55e', 600: '#16a34a' },
                        pastel: { 
                            blue: '#EEF4FF', 
                            orange: '#FFF7ED', 
                            pink: '#FDF2F8', 
                            mint: '#ECFDF5', 
                            purple: '#F5F3FF', 
                            yellow: '#FEFCE8' 
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'shimmer': 'shimmer 2s infinite',
                        'spin-slow': 'spin 3s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '200% 0' },
                            '100%': { backgroundPosition: '-200% 0' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        .slide-up { animation: slideUp 0.4s ease-out; }
        .scale-in { animation: scaleIn 0.3s ease-out; }
        .bounce-in { animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes bounceIn { 
            0% { opacity: 0; transform: scale(0.3); } 
            50% { transform: scale(1.05); } 
            100% { opacity: 1; transform: scale(1); } 
        }
        @keyframes pulse-live { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes ping {
            75%, 100% { transform: scale(2); opacity: 0; }
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes shimmer { 
            0% { background-position: -200% 0; } 
            100% { background-position: 200% 0; } 
        }
        
        .pulse-live { animation: pulse-live 1.5s infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .shimmer { 
            background: linear-gradient(90deg, #f0f0f0 25%, #e8e8e8 50%, #f0f0f0 75%); 
            background-size: 200% 100%; 
            animation: shimmer 1.5s infinite; 
        }
        .animate-ping { animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
        
        /* Cards */
        .card-hover { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .card-hover:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 20px 40px -12px rgba(0,0,0,0.15); 
        }
        
        /* Modal */
        .modal-overlay { backdrop-filter: blur(12px); }
        .glass { background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #ddd; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #ccc; }
        
        /* Tab */
        .tab-active { 
            background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%); 
            color: white; 
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        /* Badge */
        .notification-badge { animation: bounceIn 0.3s ease-out; }
        
        /* Member Card */
        .member-card:hover .member-photo { transform: scale(1.05); }
        .member-photo { transition: transform 0.3s ease; }
        
        /* Line clamp */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Hide scrollbar */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e8e8e8 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen pb-24">
    
    <!-- Header -->
    <header class="glass sticky top-0 z-40 border-b border-gray-200/50">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="w-11 h-11 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-2xl flex items-center justify-center shadow-lg shadow-emerald-200/50 transform hover:scale-105 transition-transform">
                        <span class="text-white font-extrabold text-lg">48</span>
                    </div>
                    <div>
                        <h1 class="font-bold text-gray-800 text-lg leading-tight">ikazz - 48</h1>
                        <p class="text-xs text-gray-400">Live Streaming Platform</p>
                    </div>
                </div>
                
                <!-- Right Menu -->
                <div class="flex items-center gap-2">
                    <!-- Notification Button with Live Count -->
                    <button onclick="window.location.href='notifikasi.html'" 
                            class="relative p-2.5 hover:bg-gray-100 rounded-xl transition-all duration-200 group"
                            aria-label="Notifikasi">
                        <svg class="w-6 h-6 text-gray-600 group-hover:text-emerald-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        
                        <!-- Badge Notifikasi (Live Count) -->
                        <span id="notifBadge" class="notification-badge absolute -top-1 -right-1 min-w-[20px] h-5 bg-gradient-to-r from-red-500 to-rose-500 rounded-full text-[11px] text-white flex items-center justify-center font-bold px-1 shadow-lg shadow-red-200 hidden">
                            0
                        </span>
                        
                        <!-- Pulse Animation ketika ada notifikasi baru -->
                        <span id="notifPulse" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full animate-ping opacity-75 hidden"></span>
                    </button>
                    
                    <!-- Emergency Call Button -->
                    <button onclick="showEmergencyCall()" 
                            class="p-2.5 hover:bg-red-50 rounded-xl transition-all duration-200 group relative"
                            aria-label="Hubungi Admin">
                        <svg class="w-6 h-6 text-red-500 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </button>
                    
                    <!-- User Status -->
                    <div id="userStatus" class="hidden items-center gap-2 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-100">
                        <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                        <span class="text-xs text-emerald-700 font-semibold truncate max-w-[80px]" id="userName">Member</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-5">
        
        <!-- Welcome Banner -->
        <section class="mb-6 fade-in">
            <div class="bg-gradient-to-br from-emerald-500 via-teal-500 to-cyan-500 rounded-3xl p-6 text-white relative overflow-hidden">
                <!-- Decorative circles -->
                <div class="absolute right-0 top-0 w-64 h-64 bg-white/10 rounded-full -mr-20 -mt-20 animate-pulse-slow"></div>
                <div class="absolute right-16 bottom-0 w-48 h-48 bg-white/10 rounded-full -mb-16 animate-pulse-slow animation-delay-1000"></div>
                <div class="absolute left-1/2 top-1/2 w-72 h-72 bg-white/5 rounded-full -translate-x-1/2 -translate-y-1/2 animate-pulse-slow"></div>
                
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="bg-white/20 px-3 py-1 rounded-full text-xs font-semibold">#48LIVE</span>
                    </div>
                    <p class="text-emerald-100 text-sm mb-1 font-medium flex items-center gap-1">
                        <span class="text-xl">üëã</span> Selamat Datang di
                    </p>
                    <h2 class="text-2xl font-extrabold mb-2 flex items-center gap-2">
                        ikazz - 48 Live
                        <span class="bg-amber-400 text-amber-900 text-xs px-2 py-1 rounded-full font-bold">BETA</span>
                    </h2>
                    <p class="text-emerald-100 text-sm max-w-md leading-relaxed">
                        Tonton live streaming eksklusif dari member favorit kamu dengan kualitas terbaik!
                    </p>
                </div>
            </div>
        </section>

        <!-- Main Tabs -->
        <div class="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
            <button onclick="switchMainTab('live')" id="tabLive" 
                class="tab-active px-5 py-2.5 rounded-xl text-sm font-semibold whitespace-nowrap transition-all">
                üî¥ Live Now
            </button>
            <button onclick="switchMainTab('lineup')" id="tabLineup" 
                class="px-5 py-2.5 rounded-xl text-sm font-semibold text-gray-600 hover:bg-gray-200 whitespace-nowrap transition-all bg-white border border-gray-200">
                üë• Lineup
            </button>
            <button onclick="switchMainTab('schedule')" id="tabSchedule" 
                class="px-5 py-2.5 rounded-xl text-sm font-semibold text-gray-600 hover:bg-gray-200 whitespace-nowrap transition-all bg-white border border-gray-200">
                üìÖ Jadwal
            </button>
        </div>

        <!-- Live Section -->
        <section id="sectionLive" class="space-y-6">
            <!-- Live Now Header -->
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div class="w-3 h-3 bg-red-500 rounded-full pulse-live"></div>
                        <div class="w-3 h-3 bg-red-500 rounded-full absolute top-0 animate-ping opacity-75"></div>
                    </div>
                    <h3 class="font-bold text-gray-800 text-lg">Sedang Live</h3>
                </div>
                <button onclick="refreshRooms()" 
                    class="text-emerald-600 text-sm font-semibold hover:text-emerald-700 transition-colors flex items-center gap-1.5 px-3 py-1.5 hover:bg-emerald-50 rounded-lg">
                    <svg class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Refresh
                </button>
            </div>

            <!-- Live Rooms Grid -->
            <div id="liveRooms" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Skeleton loading -->
                <div class="bg-white rounded-2xl overflow-hidden shimmer h-80"></div>
                <div class="bg-white rounded-2xl overflow-hidden shimmer h-80 hidden md:block"></div>
                <div class="bg-white rounded-2xl overflow-hidden shimmer h-80 hidden lg:block"></div>
            </div>

            <!-- No Live Rooms -->
            <div id="noLiveRooms" class="hidden">
                <div class="bg-white rounded-3xl p-12 text-center border border-gray-100">
                    <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 float">
                        <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <h4 class="font-bold text-gray-700 text-lg mb-2">Tidak Ada Live</h4>
                    <p class="text-gray-400">Belum ada live streaming saat ini. Cek jadwal untuk info mendatang!</p>
                    <button onclick="switchMainTab('schedule')" class="mt-4 px-6 py-2 bg-emerald-500 text-white rounded-xl font-semibold hover:bg-emerald-600 transition-colors">
                        Lihat Jadwal
                    </button>
                </div>
            </div>

            <!-- Featured Schedule -->
            <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-5 border border-emerald-100 mt-6">
                <div class="flex items-center gap-3 mb-3">
                    <span class="text-2xl">‚≠ê</span>
                    <h4 class="font-bold text-gray-800">Jadwal Mendatang</h4>
                </div>
                <div id="featuredSchedule" class="text-sm text-gray-600">
                    Memuat jadwal...
                </div>
            </div>
        </section>

        <!-- Lineup Section -->
        <section id="sectionLineup" class="hidden space-y-6">
            <div class="flex items-center justify-between">
                <h3 class="font-bold text-gray-800 text-lg flex items-center gap-2">
                    <span class="text-2xl">üë•</span> Member Lineup
                </h3>
                <span class="text-sm bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full font-medium" id="memberCount">0 member</span>
            </div>
            
            <!-- Search Member -->
            <div class="relative group">
                <svg class="w-5 h-5 text-gray-400 absolute left-4 top-1/2 -translate-y-1/2 group-focus-within:text-emerald-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" id="searchMember" placeholder="Cari member berdasarkan nama..." oninput="filterMembers()" 
                    class="w-full pl-12 pr-4 py-3.5 bg-white border border-gray-200 rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all text-sm">
            </div>

            <!-- Members Grid -->
            <div id="memberLineup" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                <!-- Members will be loaded here -->
                <div class="col-span-full text-center py-12 text-gray-400">
                    <span class="text-6xl block mb-4 animate-bounce-slow">üë•</span>
                    <p class="text-lg font-medium">Memuat member...</p>
                </div>
            </div>
        </section>

        <!-- Schedule Section -->
        <section id="sectionSchedule" class="hidden space-y-6">
            <div class="flex items-center justify-between">
                <h3 class="font-bold text-gray-800 text-lg flex items-center gap-2">
                    <span class="text-2xl">üìÖ</span> Jadwal Mendatang
                </h3>
                <span class="text-sm text-gray-400 bg-white px-3 py-1 rounded-full border border-gray-200" id="currentDate"></span>
            </div>

            <!-- Calendar Mini -->
            <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm">
                <div class="flex items-center justify-between mb-4">
                    <button onclick="prevMonth()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <span id="calendarMonth" class="font-semibold text-gray-800 text-lg"></span>
                    <button onclick="nextMonth()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
                <div class="grid grid-cols-7 gap-1 text-center text-xs mb-2">
                    <span class="text-gray-400 font-medium py-2">Min</span>
                    <span class="text-gray-400 font-medium py-2">Sen</span>
                    <span class="text-gray-400 font-medium py-2">Sel</span>
                    <span class="text-gray-400 font-medium py-2">Rab</span>
                    <span class="text-gray-400 font-medium py-2">Kam</span>
                    <span class="text-gray-400 font-medium py-2">Jum</span>
                    <span class="text-gray-400 font-medium py-2">Sab</span>
                </div>
                <div id="calendarDays" class="grid grid-cols-7 gap-1">
                    <!-- Calendar days will be rendered here -->
                </div>
            </div>

            <!-- Schedule List -->
            <div id="scheduleList" class="space-y-3">
                <!-- Schedules will be loaded here -->
            </div>
        </section>

        <!-- Membership Card -->
        <section id="membershipSection" class="hidden mt-6 slide-up">
            <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-5 border border-amber-100 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-32 h-32 bg-amber-200/20 rounded-full -mr-16 -mt-16"></div>
                <div class="relative z-10 flex items-start gap-4">
                    <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center flex-shrink-0">
                        <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-gray-800 mb-1 flex items-center gap-1">
                            Membership Aktif 
                            <span class="text-amber-500">‚ú®</span>
                        </h4>
                        <p class="text-sm text-gray-500 mb-3">
                            Berlaku hingga: 
                            <span id="membershipExpiry" class="font-semibold text-amber-600">-</span>
                        </p>
                        <div class="w-full bg-amber-100 rounded-full h-2.5 overflow-hidden">
                            <div id="membershipProgress" class="bg-gradient-to-r from-amber-400 to-orange-400 h-2.5 rounded-full transition-all duration-700" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-100 z-40 shadow-lg">
        <div class="max-w-md mx-auto px-4 py-2 flex items-center justify-around">
            <!-- Home -->
            <a href="index.html" class="flex flex-col items-center gap-0.5 py-1.5 px-3 text-emerald-600 group">
                <div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                </div>
                <span class="text-xs font-semibold">Home</span>
            </a>
            
            <!-- Jadwal -->
            <a href="jadwal.html" class="flex flex-col items-center gap-0.5 py-1.5 px-3 text-gray-400 hover:text-gray-600 transition-colors group">
                <div class="w-10 h-10 hover:bg-gray-100 rounded-xl flex items-center justify-center transition-colors group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <span class="text-xs font-medium">Jadwal</span>
            </a>
            
            <!-- Live Button (Center) -->
            <a href="room.html" class="flex flex-col items-center gap-0.5 relative -mt-5 group">
                <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl flex items-center justify-center shadow-lg shadow-emerald-300/50 group-hover:shadow-xl group-hover:shadow-emerald-300/50 transition-all group-hover:-translate-y-1">
                    <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                </div>
                <span class="text-xs font-semibold text-emerald-600 mt-1">Live</span>
            </a>
            
            <!-- Lineup -->
            <a href="lineup.html" class="flex flex-col items-center gap-0.5 py-1.5 px-3 text-gray-400 hover:text-gray-600 transition-colors group">
                <div class="w-10 h-10 hover:bg-gray-100 rounded-xl flex items-center justify-center transition-colors group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                </div>
                <span class="text-xs font-medium">Lineup</span>
            </a>
            
            <!-- Profil -->
            <a href="prof.html" class="flex flex-col items-center gap-0.5 py-1.5 px-3 text-gray-400 hover:text-gray-600 transition-colors group">
                <div class="w-10 h-10 hover:bg-gray-100 rounded-xl flex items-center justify-center transition-colors group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </div>
                <span class="text-xs font-medium">Profil</span>
            </a>
        </div>
    </nav>

    <!-- Token Modal -->
    <div id="tokenModal" class="fixed inset-0 bg-black/50 modal-overlay z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-md w-full p-6 scale-in">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-emerald-100 to-teal-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-slow">
                    <svg class="w-10 h-10 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Masukkan Token</h3>
                <p class="text-gray-500 text-sm">Masukkan token untuk menonton live streaming</p>
            </div>
            <div class="mb-5">
                <input type="text" id="watchTokenInput" placeholder="XXXX-XXXX" 
                    class="w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all text-center text-xl font-mono tracking-[0.3em] uppercase">
                <p id="tokenError" class="text-red-500 text-sm mt-2 hidden text-center animate-pulse"></p>
            </div>
            <div class="flex gap-3">
                <button onclick="closeTokenModal()" class="flex-1 py-3.5 border-2 border-gray-200 rounded-2xl font-semibold text-gray-600 hover:bg-gray-50 transition-colors">Batal</button>
                <button onclick="validateWatchToken()" class="flex-1 py-3.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-2xl font-semibold hover:shadow-lg hover:shadow-emerald-200 transition-all">Konfirmasi</button>
            </div>
        </div>
    </div>

    <!-- Emergency Call Modal -->
    <div id="emergencyModal" class="fixed inset-0 bg-black/50 modal-overlay z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-sm w-full p-6 scale-in">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 float">
                    <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Hubungi Admin</h3>
                <p class="text-gray-500 text-sm">Pilih cara untuk menghubungi admin</p>
            </div>
            <div class="space-y-3">
                <a href="https://wa.me/6285183885551?text=Halo%20Admin,%20saya%20butuh%20bantuan" target="_blank" 
                   class="flex items-center gap-4 p-4 bg-green-50 hover:bg-green-100 rounded-2xl transition-all group hover:scale-105">
                    <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800">WhatsApp</p>
                        <p class="text-sm text-gray-500">Chat langsung dengan admin</p>
                    </div>
                    <svg class="w-5 h-5 text-gray-400 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
                <a href="tel:+6285183885551" 
                   class="flex items-center gap-4 p-4 bg-blue-50 hover:bg-blue-100 rounded-2xl transition-all group hover:scale-105">
                    <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800">Telepon</p>
                        <p class="text-sm text-gray-500">Hubungi langsung via telepon</p>
                    </div>
                    <svg class="w-5 h-5 text-gray-400 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
                <a href="mailto:maskyyou3@gmail.com" 
                   class="flex items-center gap-4 p-4 bg-purple-50 hover:bg-purple-100 rounded-2xl transition-all group hover:scale-105">
                    <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800">Email</p>
                        <p class="text-sm text-gray-500">Kirim email ke admin</p>
                    </div>
                    <svg class="w-5 h-5 text-gray-400 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
            </div>
            <button onclick="closeEmergencyModal()" class="w-full mt-4 py-3 border-2 border-gray-200 rounded-2xl font-semibold text-gray-600 hover:bg-gray-50 transition-colors">Tutup</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-20 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-white rounded-2xl shadow-2xl p-4 flex items-center gap-3 z-[60] transform -translate-y-full opacity-0 transition-all duration-300 border border-gray-100">
        <div id="toastIcon" class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"></div>
        <div class="flex-1 min-w-0">
            <p id="toastTitle" class="font-bold text-gray-800"></p>
            <p id="toastMessage" class="text-sm text-gray-500"></p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>

    <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDMQ961-vifb3R-Gurla3LbLM_489aHkHs-g",
            authDomain: "live2ke2.firebaseapp.com",
            projectId: "live2ke2",
            storageBucket: "live2ke2.firebasestorage.app",
            messagingSenderId: "861176752510",
            appId: "1:861176752510:web:0e1ee4e2d7f96c0b5dab2f"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ==================== STATE ====================
        let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        let selectedRoom = null;
        let allMembers = [];
        let scheduleDates = [];
        let currentCalendarDate = new Date();
        let notifications = [];
        let notificationUnsubscribe = null;
        let lastNotificationCount = 0;

        // ==================== DEVICE ID ====================
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        // ==================== USER ID FOR NOTIFICATIONS ====================
        function getUserId() {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            return userId;
        }

        // ==================== INITIALIZE ====================
        document.addEventListener('DOMContentLoaded', () => {
            setCurrentDate();
            loadRooms();
            loadMembers();
            loadSchedules();
            loadNotifications();
            initNotificationBadge();
            checkUserStatus();
            renderCalendar();
            
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    Notification.requestPermission();
                }, 5000);
            }
        });

        // ==================== NOTIFICATION BADGE LIVE COUNT ====================
        function initNotificationBadge() {
            const userId = getUserId();
            
            // Get unread notifications from localStorage
            function getUnreadNotifications() {
                const readKey = `read_notifications_${userId}`;
                try {
                    const readList = localStorage.getItem(readKey);
                    return readList ? new Set(JSON.parse(readList)) : new Set();
                } catch (e) {
                    return new Set();
                }
            }
            
            // Update badge with animation
            function updateNotificationBadge(unreadCount) {
                const badge = document.getElementById('notifBadge');
                const pulse = document.getElementById('notifPulse');
                
                if (!badge) return;
                
                if (unreadCount > 0) {
                    badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    badge.classList.remove('hidden');
                    
                    // Pulse animation for new notifications
                    if (unreadCount > lastNotificationCount) {
                        if (pulse) {
                            pulse.classList.remove('hidden');
                            setTimeout(() => {
                                if (pulse) pulse.classList.add('hidden');
                            }, 1500);
                        }
                        
                        // Vibrate on mobile (optional)
                        if (window.navigator && window.navigator.vibrate) {
                            window.navigator.vibrate(50);
                        }
                        
                        // Show toast for new notification
                        showToast('info', 'Notifikasi Baru', `Anda memiliki ${unreadCount} notifikasi belum dibaca`);
                    }
                    
                    // Update page title with count
                    const title = document.title.replace(/^\(\d+\)\s/, '');
                    document.title = `(${unreadCount}) ${title}`;
                } else {
                    badge.classList.add('hidden');
                    if (pulse) pulse.classList.add('hidden');
                    document.title = document.title.replace(/^\(\d+\)\s/, '');
                }
                
                lastNotificationCount = unreadCount;
            }
            
            // Calculate unread count
            function calculateUnreadCount(notifications) {
                const readSet = getUnreadNotifications();
                return notifications.filter(notif => !readSet.has(notif.id)).length;
            }
            
            // Real-time listener from Firestore
            if (notificationUnsubscribe) {
                notificationUnsubscribe();
            }
            
            notificationUnsubscribe = db.collection('notifications')
                .orderBy('createdAt', 'desc')
                .limit(50)
                .onSnapshot(snapshot => {
                    const notifs = [];
                    snapshot.forEach(doc => {
                        notifs.push({ id: doc.id, ...doc.data() });
                    });
                    
                    const unreadCount = calculateUnreadCount(notifs);
                    updateNotificationBadge(unreadCount);
                    
                    // Show browser notification for latest
                    const latestNotif = notifs[0];
                    if (latestNotif && isUnread(latestNotif.id)) {
                        showBrowserNotification(latestNotif);
                    }
                }, error => {
                    console.error('Error loading notifications:', error);
                });
        }

        // ==================== CHECK UNREAD STATUS ====================
        function isUnread(notificationId) {
            const userId = getUserId();
            const readKey = `read_notifications_${userId}`;
            try {
                const readList = localStorage.getItem(readKey);
                if (!readList) return true;
                const readSet = new Set(JSON.parse(readList));
                return !readSet.has(notificationId);
            } catch (e) {
                return true;
            }
        }

        // ==================== BROWSER NOTIFICATION ====================
        async function showBrowserNotification(notification) {
            if (!('Notification' in window)) return;
            
            if (Notification.permission === 'default') {
                await Notification.requestPermission();
            }
            
            if (Notification.permission === 'granted') {
                new Notification(notification.title || 'Notifikasi Baru', {
                    body: notification.message || '',
                    icon: '/icon-192x192.png',
                    badge: '/badge-72x72.png',
                    silent: false,
                    vibrate: [200, 100, 200]
                });
            }
        }

        // ==================== SET CURRENT DATE ====================
        function setCurrentDate() {
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID', options);
        }

        // ==================== TAB NAVIGATION ====================
        function switchMainTab(tab) {
            const tabs = ['live', 'lineup', 'schedule'];
            tabs.forEach(t => {
                const tabEl = document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1));
                const sectionEl = document.getElementById('section' + t.charAt(0).toUpperCase() + t.slice(1));
                
                if (t === tab) {
                    tabEl.classList.add('tab-active');
                    tabEl.classList.remove('text-gray-600', 'hover:bg-gray-200', 'bg-white', 'border', 'border-gray-200');
                    sectionEl.classList.remove('hidden');
                } else {
                    tabEl.classList.remove('tab-active');
                    tabEl.classList.add('text-gray-600', 'hover:bg-gray-200', 'bg-white', 'border', 'border-gray-200');
                    sectionEl.classList.add('hidden');
                }
            });
        }

        // ==================== LOAD ROOMS ====================
        function loadRooms() {
            const container = document.getElementById('liveRooms');
            
            db.collection('rooms').where('isLive', '==', true).onSnapshot(snapshot => {
                const noRooms = document.getElementById('noLiveRooms');
                
                if (snapshot.empty) {
                    container.innerHTML = '';
                    noRooms.classList.remove('hidden');
                    return;
                }

                noRooms.classList.add('hidden');
                container.innerHTML = '';

                snapshot.forEach((doc, index) => {
                    const room = doc.data();
                    const card = createRoomCard(doc.id, room, index);
                    container.appendChild(card);
                });
            });
        }

        function createRoomCard(id, room, index) {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-2xl overflow-hidden card-hover border border-gray-100 cursor-pointer slide-up';
            div.style.animationDelay = `${index * 0.1}s`;
            div.onclick = () => openRoom(id, room);

            div.innerHTML = `
                <div class="relative aspect-video bg-gradient-to-br from-gray-100 to-gray-200">
                    <img src="${room.thumbnail || 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800'}" 
                        alt="${room.title}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/400x225?text=Live+Stream'">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                    <div class="absolute top-3 left-3 flex items-center gap-2">
                        <span class="px-2.5 py-1 bg-red-500 text-white text-xs font-bold rounded-lg flex items-center gap-1.5 shadow-lg">
                            <span class="w-1.5 h-1.5 bg-white rounded-full pulse-live"></span>
                            LIVE
                        </span>
                    </div>
                    <div class="absolute bottom-3 left-3 right-3">
                        <h4 class="font-bold text-white text-lg truncate drop-shadow-lg">${room.title || 'Live Stream'}</h4>
                    </div>
                    <div class="absolute bottom-3 right-3 flex items-center gap-1.5 bg-black/60 px-2 py-1 rounded-lg backdrop-blur-sm">
                        <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                        </svg>
                        <span class="text-white text-sm font-semibold">${room.viewerCount || 0}</span>
                    </div>
                </div>
                <div class="p-4">
                    <p class="text-gray-500 text-sm mb-3 line-clamp-2">${room.description || 'Tidak ada deskripsi'}</p>
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center">
                            <span class="text-xs text-white font-bold">48</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-800 truncate">${room.host || 'Admin'}</p>
                            <p class="text-xs text-gray-400">${room.subtitle || 'Live Streaming'}</p>
                        </div>
                    </div>
                </div>
            `;

            return div;
        }

        function openRoom(roomId, room) {
            selectedRoom = { id: roomId, ...room };
            
            // Check if user is member
            if (currentUser && currentUser.membershipExpiry) {
                const expiry = currentUser.membershipExpiry.toDate ? currentUser.membershipExpiry.toDate() : new Date(currentUser.membershipExpiry);
                if (expiry > new Date()) {
                    window.location.href = `room.html?id=${roomId}`;
                    return;
                }
            }
            
            showTokenModal();
        }

        // ==================== LOAD MEMBERS ====================
        function loadMembers() {
            db.collection('members').orderBy('order', 'asc').onSnapshot(snapshot => {
                const container = document.getElementById('memberLineup');
                const memberCount = document.getElementById('memberCount');
                
                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12 text-gray-400">
                            <span class="text-6xl block mb-4">üë•</span>
                            <p class="text-lg font-medium">Belum ada member</p>
                        </div>
                    `;
                    memberCount.textContent = '0 member';
                    return;
                }

                memberCount.textContent = `${snapshot.size} member`;
                container.innerHTML = '';

                snapshot.forEach((doc, index) => {
                    const m = doc.data();
                    const id = doc.id;
                    
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-2xl border border-gray-100 p-4 text-center card-hover slide-up member-card';
                    card.style.animationDelay = `${index * 0.05}s`;
                    card.onclick = () => showMemberDetail(m);
                    
                    card.innerHTML = `
                        <div class="relative inline-block mb-3">
                            <img src="${m.photo || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(m.name) + '&background=10b981&color=fff'}" 
                                class="member-photo w-20 h-20 rounded-full object-cover mx-auto border-2 ${m.isOnline ? 'border-emerald-200' : 'border-gray-100'} shadow-lg" 
                                onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(m.name)}&background=10b981&color=fff'">
                            <span class="absolute bottom-0 right-0 w-5 h-5 ${m.isOnline ? 'bg-emerald-500' : 'bg-gray-400'} rounded-full border-2 border-white"></span>
                        </div>
                        <h4 class="font-bold text-gray-800 truncate">${m.name}</h4>
                        <p class="text-xs text-gray-400 truncate mb-2">${m.info || '-'}</p>
                        
                        <!-- Social Icons -->
                        <div class="flex justify-center gap-2 mb-2">
                            ${m.instagram ? `<a href="https://instagram.com/${m.instagram}" target="_blank" class="w-7 h-7 bg-pink-100 rounded-full flex items-center justify-center text-xs hover:bg-pink-200 transition-colors" onclick="event.stopPropagation()">üì∏</a>` : ''}
                            ${m.twitter ? `<a href="https://twitter.com/${m.twitter}" target="_blank" class="w-7 h-7 bg-blue-100 rounded-full flex items-center justify-center text-xs hover:bg-blue-200 transition-colors" onclick="event.stopPropagation()">üê¶</a>` : ''}
                            ${m.tiktok ? `<a href="https://tiktok.com/@${m.tiktok}" target="_blank" class="w-7 h-7 bg-gray-100 rounded-full flex items-center justify-center text-xs hover:bg-gray-200 transition-colors" onclick="event.stopPropagation()">üéµ</a>` : ''}
                        </div>

                        <!-- Stats -->
                        <div class="flex justify-center gap-3 text-xs text-gray-400">
                            <span class="flex items-center gap-1">‚ù§Ô∏è ${m.followers || 0}</span>
                            <span class="flex items-center gap-1">üé¨ ${m.lives || 0}</span>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
            });
        }

        function showMemberDetail(member) {
            showToast('info', member.name, 'Detail member akan segera hadir!');
        }

        function filterMembers() {
            const query = document.getElementById('searchMember').value.toLowerCase();
            const cards = document.querySelectorAll('#memberLineup > div:not(.col-span-full)');
            
            cards.forEach(card => {
                const name = card.querySelector('h4').textContent.toLowerCase();
                if (name.includes(query)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // ==================== LOAD SCHEDULES ====================
        function loadSchedules() {
            db.collection('schedules').orderBy('date', 'asc').onSnapshot(snapshot => {
                const container = document.getElementById('scheduleList');
                const featuredContainer = document.getElementById('featuredSchedule');
                scheduleDates = [];
                
                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="bg-white rounded-2xl p-8 text-center border border-gray-100">
                            <svg class="w-16 h-16 mx-auto mb-3 text-gray-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p class="text-gray-400">Tidak ada jadwal mendatang</p>
                        </div>
                    `;
                    featuredContainer.innerHTML = 'Belum ada jadwal';
                    return;
                }

                container.innerHTML = '';
                let featuredHtml = '';
                let featuredCount = 0;

                snapshot.forEach((doc, index) => {
                    const schedule = { id: doc.id, ...doc.data() };
                    const date = schedule.date?.toDate ? schedule.date.toDate() : new Date(schedule.date);
                    
                    // Store dates for calendar
                    scheduleDates.push(date.toDateString());

                    // Only show upcoming
                    if (date >= new Date(new Date().setHours(0,0,0,0))) {
                        container.appendChild(createScheduleCard(schedule, index));
                        
                        // Featured (max 3)
                        if (featuredCount < 3) {
                            const dayName = date.toLocaleDateString('id-ID', { weekday: 'short' });
                            const day = date.getDate();
                            const month = date.toLocaleDateString('id-ID', { month: 'short' });
                            featuredHtml += `<div class="flex items-center gap-2 text-sm mb-2"><span class="w-16 text-emerald-600">${dayName}, ${day} ${month}</span><span class="text-gray-600">${schedule.title}</span></div>`;
                            featuredCount++;
                        }
                    }
                });

                featuredContainer.innerHTML = featuredHtml || 'Tidak ada jadwal dalam waktu dekat';
                renderCalendar();
            });
        }

        function createScheduleCard(schedule, index) {
            const div = document.createElement('div');
            const date = schedule.date?.toDate ? schedule.date.toDate() : new Date(schedule.date);
            const day = date.getDate();
            const month = date.toLocaleDateString('id-ID', { month: 'short' });
            const time = date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            const dayName = date.toLocaleDateString('id-ID', { weekday: 'long' });

            const colors = [
                { bg: 'bg-pastel-blue', text: 'text-blue-600', border: 'border-blue-100' },
                { bg: 'bg-pastel-orange', text: 'text-orange-600', border: 'border-orange-100' },
                { bg: 'bg-pastel-pink', text: 'text-pink-600', border: 'border-pink-100' },
                { bg: 'bg-pastel-mint', text: 'text-emerald-600', border: 'border-emerald-100' },
                { bg: 'bg-pastel-purple', text: 'text-purple-600', border: 'border-purple-100' }
            ];
            const color = colors[index % colors.length];

            div.className = `bg-white rounded-2xl p-4 flex items-center gap-4 card-hover border ${color.border} slide-up cursor-pointer hover:shadow-md`;
            div.style.animationDelay = `${index * 0.1}s`;
            div.onclick = () => showToast('info', schedule.title, date.toLocaleString('id-ID'));

            div.innerHTML = `
                <div class="w-16 h-16 ${color.bg} rounded-2xl flex flex-col items-center justify-center flex-shrink-0">
                    <span class="text-2xl font-extrabold ${color.text}">${day}</span>
                    <span class="text-xs font-medium ${color.text}">${month}</span>
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="font-bold text-gray-800 truncate">${schedule.title || 'Live Stream'}</h4>
                    <p class="text-sm text-gray-500">${dayName}, ${time} WIB</p>
                    <p class="text-xs text-gray-400 truncate mt-1 line-clamp-2">${schedule.description || ''}</p>
                </div>
                <div class="flex-shrink-0">
                    <span class="px-3 py-1.5 bg-emerald-100 text-emerald-700 text-xs font-semibold rounded-full whitespace-nowrap">Upcoming</span>
                </div>
            `;

            return div;
        }

        // ==================== CALENDAR ====================
        function renderCalendar() {
            const container = document.getElementById('calendarDays');
            const monthLabel = document.getElementById('calendarMonth');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            monthLabel.textContent = currentCalendarDate.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            let html = '';
            
            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }
            
            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateObj = new Date(year, month, day);
                const isToday = dateObj.toDateString() === today.toDateString();
                const hasSchedule = scheduleDates.includes(dateObj.toDateString());
                
                let classes = 'w-9 h-9 flex items-center justify-center rounded-full text-sm font-medium transition-all cursor-pointer hover:bg-gray-100 mx-auto';
                
                if (isToday) {
                    classes = 'w-9 h-9 flex items-center justify-center rounded-full text-sm font-bold bg-emerald-500 text-white mx-auto';
                } else if (hasSchedule) {
                    classes = 'w-9 h-9 flex items-center justify-center rounded-full text-sm font-medium bg-emerald-100 text-emerald-700 mx-auto';
                }
                
                html += `<div class="${classes}" onclick="showToast('info', '${day} ${monthLabel.textContent}', '${hasSchedule ? 'Ada jadwal' : 'Tidak ada jadwal'}')">${day}</div>`;
            }
            
            container.innerHTML = html;
        }

        function prevMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }

        // ==================== NOTIFICATIONS ====================
        function loadNotifications() {
            db.collection('notifications').orderBy('createdAt', 'desc').limit(20).onSnapshot(snapshot => {
                notifications = [];
                snapshot.forEach(doc => {
                    const notif = { id: doc.id, ...doc.data() };
                    notifications.push(notif);
                });
            });
        }

        // ==================== TOKEN MODAL ====================
        function showTokenModal() {
            document.getElementById('tokenModal').classList.remove('hidden');
            document.getElementById('tokenModal').classList.add('flex');
            document.getElementById('watchTokenInput').focus();
        }

        function closeTokenModal() {
            document.getElementById('tokenModal').classList.add('hidden');
            document.getElementById('tokenModal').classList.remove('flex');
            document.getElementById('watchTokenInput').value = '';
            document.getElementById('tokenError').classList.add('hidden');
        }

        async function validateWatchToken() {
            const token = document.getElementById('watchTokenInput').value.trim().toUpperCase();
            const deviceId = getDeviceId();

            if (!token) {
                showTokenError('Masukkan token');
                return;
            }

            try {
                const tokenDoc = await db.collection('watchTokens').doc(token).get();
                
                if (!tokenDoc.exists) {
                    showTokenError('Token tidak ditemukan');
                    return;
                }

                const tokenData = tokenDoc.data();

                if (tokenData.used && tokenData.deviceId !== deviceId) {
                    showTokenError('Token sudah digunakan di perangkat lain');
                    return;
                }

                if (tokenData.roomId && tokenData.roomId !== selectedRoom.id) {
                    showTokenError('Token tidak valid untuk room ini');
                    return;
                }

                await db.collection('watchTokens').doc(token).update({
                    used: true,
                    deviceId: deviceId,
                    usedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                localStorage.setItem('watchToken', token);
                closeTokenModal();
                window.location.href = `room.html?id=${selectedRoom.id}`;

            } catch (error) {
                console.error('Token validation error:', error);
                showTokenError('Terjadi kesalahan');
            }
        }

        function showTokenError(message) {
            const errorEl = document.getElementById('tokenError');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }

        // ==================== EMERGENCY CALL ====================
        function showEmergencyCall() {
            document.getElementById('emergencyModal').classList.remove('hidden');
            document.getElementById('emergencyModal').classList.add('flex');
        }

        function closeEmergencyModal() {
            document.getElementById('emergencyModal').classList.add('hidden');
            document.getElementById('emergencyModal').classList.remove('flex');
        }

        // ==================== USER STATUS ====================
        function checkUserStatus() {
            const userStatus = document.getElementById('userStatus');
            const membershipSection = document.getElementById('membershipSection');
            
            if (currentUser && currentUser.membershipExpiry) {
                const expiry = currentUser.membershipExpiry.toDate ? currentUser.membershipExpiry.toDate() : new Date(currentUser.membershipExpiry);
                
                if (expiry > new Date()) {
                    userStatus.classList.remove('hidden');
                    userStatus.classList.add('flex');
                    document.getElementById('userName').textContent = currentUser.name || 'Member';
                    
                    membershipSection.classList.remove('hidden');
                    document.getElementById('membershipExpiry').textContent = expiry.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                    
                    const createdAt = currentUser.createdAt?.toDate ? currentUser.createdAt.toDate() : new Date(currentUser.createdAt || Date.now());
                    const totalDays = (expiry - createdAt) / (1000 * 60 * 60 * 24);
                    const remainingDays = (expiry - new Date()) / (1000 * 60 * 60 * 24);
                    const progress = Math.max(0, Math.min(100, (remainingDays / totalDays) * 100));
                    document.getElementById('membershipProgress').style.width = progress + '%';
                }
            }
        }

        function refreshRooms() {
            showToast('success', 'Refresh', 'Data berhasil diperbarui');
        }

        // ==================== TOAST ====================
        function showToast(type, title, message) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');

            const icons = {
                success: { bg: 'bg-emerald-100', color: 'text-emerald-600', emoji: '‚úÖ' },
                error: { bg: 'bg-red-100', color: 'text-red-600', emoji: '‚ùå' },
                info: { bg: 'bg-blue-100', color: 'text-blue-600', emoji: '‚ÑπÔ∏è' }
            };

            const icon = icons[type] || icons.info;
            toastIcon.className = `w-12 h-12 rounded-xl flex items-center justify-center ${icon.bg}`;
            toastIcon.innerHTML = `<span class="text-2xl">${icon.emoji}</span>`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toast.classList.remove('-translate-y-full', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');
            
            setTimeout(() => {
                toast.classList.add('-translate-y-full', 'opacity-0');
                toast.classList.remove('translate-y-0', 'opacity-100');
            }, 4000);
        }

        // ==================== CLEANUP ====================
        window.addEventListener('beforeunload', () => {
            if (notificationUnsubscribe) {
                notificationUnsubscribe();
            }
        });
    </script>
</body>
</html>